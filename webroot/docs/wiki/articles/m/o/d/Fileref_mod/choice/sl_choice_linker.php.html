<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- headlinks removed -->
	<link rel="shortcut icon" href="../../../../misc/favicon.ico"/>
    <title>Fileref:mod/choice/sl choice linker.php - SLIS Second Life Wiki</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../../skins/offline/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/md5.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/utf8.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/lookup.js"></script>
                      </head>
  <body
    class="ns-0 ns-subject page-Fileref_mod_choice_sl_choice_linker_php">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">Fileref:mod/choice/sl choice linker.php</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From SLIS Second Life Wiki</h3>
	    <div id="contentSub"></div>
	    	    	    <!-- start content -->
	    <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p><a href="../../../../articles/f/o/l/File:Folder.gif.html" class="image"><img alt="Folder.gif" src="../../../../images/6/2F/6/6/67/Folder.gif" width="16" height="16" /></a>  <a href="../../../../articles/m/o/d/Fileref:mod/chat.html" title="Fileref:mod/chat">(parent)</a> <br />
</p><p>This <a href="../../../../articles/l/i/n/Linker_Script.html" title="Linker Script">Linker Script</a> allows the <a href="../../../../articles/s/l/o/Sloodle_Choice.html" title="Sloodle Choice">Sloodle Choice</a> object in Second Life to query and interact with instances of the Moodle choice module. It has 3 modes of operation:
</p>
<ol><li> Available choices query&#160;: returns a list of choice module instances available in the specified course
</li><li> Choice details query&#160;: returns the details for a specific choice instance
</li><li> Option selection&#160;: informs Moodle that a user has made a selection
</li></ol>
<p>By default, the script behaves in mode 1, unless the parameters for other modes are specified.
</p><p><br />
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Additional_Information"><span class="tocnumber">1</span> <span class="toctext">Additional Information</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Dependencies"><span class="tocnumber">2</span> <span class="toctext">Dependencies</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Request_Parameters"><span class="tocnumber">3</span> <span class="toctext">Request Parameters</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Response"><span class="tocnumber">4</span> <span class="toctext">Response</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Mode_1"><span class="tocnumber">4.1</span> <span class="toctext">Mode 1</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Mode_2"><span class="tocnumber">4.2</span> <span class="toctext">Mode 2</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Mode_3"><span class="tocnumber">4.3</span> <span class="toctext">Mode 3</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Algorithm"><span class="tocnumber">5</span> <span class="toctext">Algorithm</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#See_Also"><span class="tocnumber">6</span> <span class="toctext">See Also</span></a></li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="Additional_Information"> Additional Information </span></h1>
<p>Debug mode will output additional data, indicating what is happening at all points in the script.
</p><p><br />
</p>
<h1> <span class="mw-headline" id="Dependencies"> Dependencies </span></h1>
<p>Sloodle files:
</p>
<ul><li> <a href="../../../../articles/c/o/n/Fileref:config.php.html" title="Fileref:config.php">config.php</a>
</li><li> <a href="../../../../articles/s/l/_/Fileref:sl_debug.php.html" title="Fileref:sl debug.php">sl_debug.php</a>
</li><li> <a href="../../../../articles/l/i/b/Fileref:lib/sl_lsllib.php.html" title="Fileref:lib/sl lsllib.php">lib/sl_lsllib.php</a>
</li><li> <a href="../../../../articles/m/o/d/Fileref:mod/choice/sl_choice_lib.php.html" title="Fileref:mod/choice/sl choice lib.php">mod/choice/sl_choice_lib.php</a>
</li></ul>
<p><br />
</p>
<h1> <span class="mw-headline" id="Request_Parameters"> Request Parameters </span></h1>
<p>The following parameters are always required:
</p>
<ul><li> sloodlepwd = the prim password used to authenticate the choice object for this site
</li><li> sloodlecourseid = ID of the course which the request relates to
</li></ul>
<p><br />
The following additional parameter is required for modes 2 and 3:
</p>
<ul><li> sloodlemoduleid = course module instance ID of the desired choice
</li></ul>
<p><br />
The following additional parameters are also required for mode 3:
</p>
<ul><li> sloodleoptionid = ID of the choice option being selected
</li><li> sloodleuuid = the SL UUID of the agent chatting (optional if 'sloodleavname' is specified)
</li><li> sloodleavname = the name of the agent chatting (optional if 'sloodleuuid' is specified)
</li></ul>
<p><br />
The following parameter is always optional:
</p>
<ul><li> sloodledebug = activates debug mode
</li></ul>
<p><br />
<b>Note:</b> if parameter 'sloodleoptionid' is specified, then script will attempt to adopt mode 3. If not, but 'sloodlemoduleid' <i>is</i> specified, then it adopts mode 2. Otherwise, it will default to mode 1.
</p><p><br />
</p>
<h1> <span class="mw-headline" id="Response"> Response </span></h1>
<ul><li> <b>Note:</b> the response format is likely to change slightly, to bring it into line with other linker scripts.
</li></ul>
<h4> <span class="mw-headline" id="Mode_1"> Mode 1 </span></h4>
<p>If a list of at least one choice in the specified course has been successfully retrieved, the status code returned is 10021. The first line indicates the number of choices available, while each subsequent line describes a choice instance, as follows:
</p>
<pre>10021|CHOICE_LIST_QUERY
num_instances|{integer: number of choice instances in the course}
choice_instance|{integer: id number of instance}|{string: name of instance}
</pre>
<p>The "id number of instance" value is the number that should be passed in via parameter 'sloodlemoduleid' for modes 2 and 3. The following example shows a possible response from a course with 3 choices:
</p>
<pre>10021|CHOICE_LIST_QUERY
num_instances|3
choice_instance|18|Operating system survey
choice_instance|23|Favourite programming language
choice_instance|24|Number of computers owned
</pre>
<p><br />
If no choices are available, then the status code will be -10022. If a general error occurs while querying for choices, the status code will be -10021. In either case, an error message will be contained in the data line. (Other standard error codes may also be returned).
</p>
<ul><li> <b>Note:</b> it is likely that the status code will become 1 for success, the first data line will be omitted completely, and the "choice_instance|" will be removed from the beginning of every subsequent line. This makes the communications more data-efficient, and is in line with the other tools.
</li></ul>
<h4> <span class="mw-headline" id="Mode_2"> Mode 2 </span></h4>
<p>If successful in querying for the details of a choice, the status code will be 10001, and there will be several data lines, as follows:
</p>
<pre>10001|CHOICE_QUERY
choice_name|{string:name of choice}
choice_text|{string:text of choice (i.e. question)}
num_options|{integer:number of options}
option|{integer:option id}|{string:option text}|{integer:number selected so far}
num_unanswered|{integer:number of students not yet answered}
accepting_answers|{true/false:is the choice currently open?}
</pre>
<p>The "option id" integer is the value that should be passed in via parameter 'sloodleoptionid' for mode 3.
</p><p>(<b>Note:</b> the ordering of the lines can be arbitrary!) There will be as many "option|..." lines as there are options in the choice. The number selected so far of each option (and the number not yet answered) will be -1 if the information is not to be displayed.
</p><p>Here is an example of a choice which has been closed, and for which the results are visible, but the number of people who didn't choose is not visible:
</p>
<pre>10001|CHOICE_QUERY
choice_name|Cheese Survey
choice_text|Which of these cheeses do you like best?
num_options|4
option|1|Stilton|2
option|2|Wensleydale|7
option|3|Parmesan|4
option|4|None of them|6
num_unanswered|-1
accepting_answers|false
</pre>
<p>If the linker script fails to query for details of the choice, then the status code will be -10001. (Other standard error codes may also be returned).
</p>
<ul><li> <b>Note:</b> in order to bring the choice linker into line with other scripts, the status code for success in mode 2 is likely to become 1. Otherwise, the format for the response is likely to remain the same.
</li></ul>
<h4> <span class="mw-headline" id="Mode_3"> Mode 3 </span></h4>
<p>If successful in selecting an option, the script will respond with status code 10011, and there will be no data line. (Eventually, the status code will likely become 1 for success).
</p><p><br />
If the choice has been closed and selections are therefore no longer being accepted, the status code returned will be -10014, and an error message will be contained in the data line. (Other standard error codes may also be returned).
</p><p><br />
</p>
<h1> <span class="mw-headline" id="Algorithm"> Algorithm </span></h1>
<ol><li> Fetch the custom parameter ('sloodleoptionid')
</li><li> Create <a href="../../../../articles/s/l/o/SloodleLSLHandler.html" title="SloodleLSLHandler">SloodleLSLHandler</a> object
</li><li> Process request data
</li><li> Authenticate request
</li><li> Fetch course record (terminate on failure)
</li><li> Was module ID omitted? If so than enter <i>mode 1</i>:
<ol><li> Fetch list of available choices in course (terminate on failure)
</li><li> Were there no available choices in the course? If so then:
<ol><li> Output error message
</li><li> Terminate script
</li></ol>
</li><li> Output number of available choices
</li><li> Iterate through choices and output each one
</li><li> Render response
</li><li> Terminate script
</li></ol>
</li><li> Retrieve course module instance (terminate on failure)
</li><li> Retreive choice record from database (terminate on failure)
</li><li> Was the option ID omitted? If yes then enter <i>mode 2</i>:
<ol><li> Determine if choice is open
</li><li> Determine if results should be shown publicly in-world
</li><li> Determine if the number of unanswered users should be displayed? If yes then:
<ol><li> Calculate how many have not answered
</li></ol>
</li><li> Prepare other choice data
</li><li> Output choice data
</li><li> Iterate through each option and output it
</li><li> Render response
</li><li> Terminate script
</li></ol>
</li><li> <i>(Falling through to mode 3)</i>
</li><li> Attempt to login the user (terminate on failure)
</li><li> Ensure user is enrolled in the course (terminate on failure)
</li><li> Attempt to select the appropriate choice option
</li><li> Output success/failure
</li><li> Render response
</li><li> Terminate script
</li></ol>
<p><br />
</p>
<h1> <span class="mw-headline" id="See_Also"> See Also </span></h1>
<ul><li> <a href="../../../../articles/m/o/d/Fileref:mod/choice/sl_choice_lib.php.html" title="Fileref:mod/choice/sl choice lib.php">mod/choice/sl_choice_lib.php</a>
</li></ul>
<p><br />
</p>
<table style="background-color:white; border:1px solid #0099cc; text-align:center; width:100%;">
<tr>
<th style="background-color:#99d9ea;" colspan="4"> This page is part of the SLOODLE documentation
</th></tr>
<tr>
<td style="border-bottom:solid 1px #dddddd;"> Docs: <a href="../../../../articles/s/l/o/SloodleUserDocs.html" title="SloodleUserDocs" class="mw-redirect">Users</a> | <a href="../../../../articles/s/l/o/SloodleAdminDocs.html" title="SloodleAdminDocs" class="mw-redirect">Administrators</a> | <a href="../../../../articles/s/l/o/SloodleDevDocs.html" title="SloodleDevDocs" class="mw-redirect">Developers</a>
</td></tr>
<tr>
<td style=""> <span style="float:left"><a href="../../../../articles/s/l/o/Sloodle.html" title="Sloodle" class="mw-redirect">Wiki Frontpage</a></span> <span style="float:right"><a rel="nofollow" class="external text" href="http://www.sloodle.org">Sloodle.org</a></span>
</td></tr></table>

<!-- 
NewPP limit report
Preprocessor node count: 44/1000000
Post‐expand include size: 543/2097152 bytes
Template argument size: 31/2097152 bytes
Expensive parser function count: 0/100
-->
</div><div class="printfooter">
</div>
	    <div id="catlinks"><div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="http://localhost/sl/index.php/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="../../../../articles/s/l/o/Category:SloodleFileRef.html" title="Category:SloodleFileRef">SloodleFileRef</a></li></ul></div></div></div>	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-main"
	       class="selected"	       ><a href="../../../../articles/m/o/d/Fileref:mod/choice/sl_choice_linker.php.html">Page</a></li><li id="ca-talk"
	       class="new"	       ><a href="http:http://localhost/sl/index.php?title=Talk:Fileref:mod/choice/sl_choice_linker.php&amp;action=edit&amp;redlink=1">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://localhost/sl/index.php/Fileref:mod/choice/sl_choice_linker.php">Latest revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../../misc/wiki.png);"
	    href="../../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-mainpage-description"><a href="../../../../index.html">Main page</a></li>
	     	      <li id="n-SLOODLE"><a href="../../../../articles/s/l/o/Sloodle.html">SLOODLE</a></li>
	     	      <li id="n-currentevents"><a href="../../../../articles/c/u/r/SLIS_Second_Life_Wiki:Current_events.html">Current events</a></li>
	     	      <li id="n-help"><a href="../../../../articles/c/o/n/Help:Contents.html">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-SEARCH'>
	  <h5>Search</h5>
	  <div class='pBody'>
	    <ul>
	    	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-TOOLBOX'>
	  <h5>Toolbox</h5>
	  <div class='pBody'>
	    <ul>
	    	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-LANGUAGES'>
	  <h5>LANGUAGES</h5>
	  <div class='pBody'>
	    <ul>
	    	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="//www.mediawiki.org/"><img src="../../../../skins/common/images/poweredby_mediawiki_88x31.png" height="31" width="88" alt="Powered by MediaWiki" /></a></div>		<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 11:13, 29 January 2008 by SLIS Second Life Wiki user <a href="http:http://localhost/sl/index.php?title=User:Peter_Bloomfield&amp;action=edit&amp;redlink=1" class="new" title="User:Peter Bloomfield (page does not exist)">Peter Bloomfield</a>. </li>	  	  <li id="f-about"><a href="../../../../articles/a/b/o/SLIS_Second_Life_Wiki:About.html" title="SLIS Second Life Wiki:About">About SLIS Second Life Wiki</a></li>	  <li id="f-disclaimer"><a href="../../../../articles/g/e/n/SLIS_Second_Life_Wiki:General_disclaimer.html" title="SLIS Second Life Wiki:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
